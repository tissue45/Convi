# ë°ì´í„°ë² ì´ìŠ¤ ERD (Entity Relationship Diagram)

## ğŸ“Š ì „ì²´ ERD ê°œìš”

í¸ì˜ì  ì¢…í•© ì†”ë£¨ì…˜ì€ **36ê°œì˜ í…Œì´ë¸”**ë¡œ êµ¬ì„±ëœ ì™„ì „í•œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ğŸ¯ ERD ë‹¤ì´ì–´ê·¸ë¨ (í…ìŠ¤íŠ¸ í‘œí˜„)

```
                    í¸ì˜ì  ì¢…í•© ì†”ë£¨ì…˜ ERD (36 Tables)
                                   
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  profiles   â”‚â”€â”€â”€â”€â”‚   stores    â”‚â”€â”€â”€â”€â”‚ store_products  â”‚
    â”‚             â”‚    â”‚             â”‚    â”‚                 â”‚
    â”‚ - id (PK)   â”‚    â”‚ - id (PK)   â”‚    â”‚ - id (PK)       â”‚
    â”‚ - role      â”‚    â”‚ - owner_id  â”‚    â”‚ - store_id (FK) â”‚
    â”‚ - full_name â”‚    â”‚ - name      â”‚    â”‚ - product_id(FK)â”‚
    â”‚ - phone     â”‚    â”‚ - address   â”‚    â”‚ - price         â”‚
    â”‚ - email     â”‚    â”‚ - location  â”‚    â”‚ - stock         â”‚
    â”‚ - ...       â”‚    â”‚ - ...       â”‚    â”‚ - discount_rate â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                        â”‚
           â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  products   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚             â”‚
                        â”‚ - id (PK)   â”‚
                        â”‚ - name      â”‚
                        â”‚ - category  â”‚
                        â”‚ - barcode   â”‚
                        â”‚ - base_priceâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ categories  â”‚
                    â”‚             â”‚
                    â”‚ - id (PK)   â”‚
                    â”‚ - name      â”‚
                    â”‚ - parent_id â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   orders    â”‚â”€â”€â”€â”€â”‚ order_items â”‚    â”‚ order_status_   â”‚
    â”‚             â”‚    â”‚             â”‚    â”‚   history       â”‚
    â”‚ - id (PK)   â”‚    â”‚ - id (PK)   â”‚    â”‚                 â”‚
    â”‚ - customer  â”‚    â”‚ - order_id  â”‚    â”‚ - order_id (FK) â”‚
    â”‚ - store_id  â”‚    â”‚ - product   â”‚    â”‚ - status        â”‚
    â”‚ - status    â”‚    â”‚ - quantity  â”‚    â”‚ - changed_at    â”‚
    â”‚ - total     â”‚    â”‚ - price     â”‚    â”‚ - changed_by    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚supply_req.. â”‚â”€â”€â”€â”€â”‚supply_request_  â”‚    â”‚ shipments   â”‚
    â”‚             â”‚    â”‚   items         â”‚    â”‚             â”‚
    â”‚ - id (PK)   â”‚    â”‚                 â”‚    â”‚ - id (PK)   â”‚
    â”‚ - store_id  â”‚    â”‚ - request_id(FK)â”‚    â”‚ - request_idâ”‚
    â”‚ - status    â”‚    â”‚ - product_id(FK)â”‚    â”‚ - status    â”‚
    â”‚ - requested â”‚    â”‚ - quantity      â”‚    â”‚ - shipped_atâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   points    â”‚    â”‚  coupons    â”‚â”€â”€â”€â”€â”‚  user_coupons   â”‚
    â”‚             â”‚    â”‚             â”‚    â”‚                 â”‚
    â”‚ - id (PK)   â”‚    â”‚ - id (PK)   â”‚    â”‚ - id (PK)       â”‚
    â”‚ - user_id   â”‚    â”‚ - name      â”‚    â”‚ - user_id (FK)  â”‚
    â”‚ - amount    â”‚    â”‚ - type      â”‚    â”‚ - coupon_id(FK) â”‚
    â”‚ - type      â”‚    â”‚ - discount  â”‚    â”‚ - status        â”‚
    â”‚ - created_atâ”‚    â”‚ - valid_untilâ”‚    â”‚ - used_at      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ wishlists   â”‚â”€â”€â”€â”€â”‚product_wishlistsâ”‚    â”‚notificationsâ”‚
    â”‚             â”‚    â”‚                 â”‚    â”‚             â”‚
    â”‚ - id (PK)   â”‚    â”‚ - wishlist_id   â”‚    â”‚ - id (PK)   â”‚
    â”‚ - user_id   â”‚    â”‚ - product_id    â”‚    â”‚ - user_id   â”‚
    â”‚ - name      â”‚    â”‚ - added_at      â”‚    â”‚ - type      â”‚
    â”‚ - created_atâ”‚    â”‚                 â”‚    â”‚ - message   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚inventory_trans..â”‚    â”‚daily_sales_sum..â”‚    â”‚product_salesâ”‚
    â”‚                 â”‚    â”‚                 â”‚    â”‚ _summary    â”‚
    â”‚ - id (PK)       â”‚    â”‚ - id (PK)       â”‚    â”‚             â”‚
    â”‚ - store_id      â”‚    â”‚ - store_id      â”‚    â”‚ - id (PK)   â”‚
    â”‚ - product_id    â”‚    â”‚ - date          â”‚    â”‚ - store_id  â”‚
    â”‚ - type          â”‚    â”‚ - total_sales   â”‚    â”‚ - product_idâ”‚
    â”‚ - quantity      â”‚    â”‚ - total_orders  â”‚    â”‚ - quantity  â”‚
    â”‚ - transaction_atâ”‚    â”‚ - created_at    â”‚    â”‚ - revenue   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ system_settings â”‚
    â”‚                 â”‚
    â”‚ - id (PK)       â”‚
    â”‚ - key           â”‚
    â”‚ - value         â”‚
    â”‚ - description   â”‚
    â”‚ - updated_at    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— ì£¼ìš” ê´€ê³„ (Relationships)

### 1. ì‚¬ìš©ì ì¤‘ì‹¬ ê´€ê³„
```
profiles (1) â”€â”€â”€â”€ (1) stores (ì ì£¼ì˜ ê²½ìš°)
profiles (1) â”€â”€â”€â”€ (M) orders (ê³ ê° ì£¼ë¬¸)
profiles (1) â”€â”€â”€â”€ (M) points (í¬ì¸íŠ¸ ë‚´ì—­)
profiles (1) â”€â”€â”€â”€ (M) user_coupons (ì¿ í° ì†Œìœ )
profiles (1) â”€â”€â”€â”€ (M) wishlists (ìœ„ì‹œë¦¬ìŠ¤íŠ¸)
```

### 2. ìƒí’ˆ ê´€ê³„
```
categories (1) â”€â”€â”€â”€ (M) products
products (1) â”€â”€â”€â”€ (M) store_products (ì í¬ë³„ ìƒí’ˆ)
products (1) â”€â”€â”€â”€ (M) order_items (ì£¼ë¬¸ ìƒí’ˆ)
products (1) â”€â”€â”€â”€ (M) supply_request_items
products (1) â”€â”€â”€â”€ (M) inventory_transactions
```

### 3. ì£¼ë¬¸ ê´€ê³„
```
orders (1) â”€â”€â”€â”€ (M) order_items
orders (1) â”€â”€â”€â”€ (M) order_status_history
```

### 4. ë¬¼ë¥˜ ê´€ê³„
```
supply_requests (1) â”€â”€â”€â”€ (M) supply_request_items
supply_requests (1) â”€â”€â”€â”€ (1) shipments
```

### 5. ì¿ í° ê´€ê³„
```
coupons (1) â”€â”€â”€â”€ (M) user_coupons
```

### 6. ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê´€ê³„
```
wishlists (1) â”€â”€â”€â”€ (M) product_wishlists
```

## ğŸ“‹ í…Œì´ë¸”ë³„ ìƒì„¸ ì •ë³´

### í•µì‹¬ í…Œì´ë¸” (Core Tables)

#### 1. profiles - ì‚¬ìš©ì í”„ë¡œí•„
- **ìš©ë„**: ëª¨ë“  ì‚¬ìš©ì(ê³ ê°, ì ì£¼, ë³¸ì‚¬) ê¸°ë³¸ ì •ë³´
- **ê´€ê³„**: 
  - stores (1:1, ì ì£¼ì˜ ê²½ìš°)
  - orders (1:M, ê³ ê° ì£¼ë¬¸)
  - points (1:M)
  - user_coupons (1:M)

#### 2. stores - ì í¬ ì •ë³´
- **ìš©ë„**: í¸ì˜ì  ì í¬ ê¸°ë³¸ ì •ë³´ ë° ìš´ì˜ ìƒíƒœ
- **ê´€ê³„**:
  - profiles (1:1, ì ì£¼)
  - store_products (1:M)
  - orders (1:M)
  - supply_requests (1:M)

#### 3. products - ìƒí’ˆ ë§ˆìŠ¤í„°
- **ìš©ë„**: ì „ì²´ ìƒí’ˆ ì¹´íƒˆë¡œê·¸ ê´€ë¦¬
- **ê´€ê³„**:
  - categories (M:1)
  - store_products (1:M)
  - order_items (1:M)

#### 4. categories - ìƒí’ˆ ì¹´í…Œê³ ë¦¬
- **ìš©ë„**: ê³„ì¸µì  ìƒí’ˆ ë¶„ë¥˜ ì‹œìŠ¤í…œ
- **ê´€ê³„**:
  - products (1:M)
  - categories (self-reference, ê³„ì¸µ êµ¬ì¡°)

### ìš´ì˜ í…Œì´ë¸” (Operational Tables)

#### 5. store_products - ì í¬ë³„ ìƒí’ˆ
- **ìš©ë„**: ì í¬ë³„ ìƒí’ˆ ê°€ê²©, ì¬ê³ , í• ì¸ ì •ë³´
- **ê´€ê³„**:
  - stores (M:1)
  - products (M:1)

#### 6. orders - ì£¼ë¬¸
- **ìš©ë„**: ê³ ê° ì£¼ë¬¸ ì •ë³´
- **ê´€ê³„**:
  - profiles (M:1, ê³ ê°)
  - stores (M:1)
  - order_items (1:M)
  - order_status_history (1:M)

#### 7. order_items - ì£¼ë¬¸ ìƒí’ˆ
- **ìš©ë„**: ì£¼ë¬¸ì— í¬í•¨ëœ ê°œë³„ ìƒí’ˆ ì •ë³´
- **ê´€ê³„**:
  - orders (M:1)
  - products (M:1)

#### 8. order_status_history - ì£¼ë¬¸ ìƒíƒœ ì´ë ¥
- **ìš©ë„**: ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì¶”ì 
- **ê´€ê³„**:
  - orders (M:1)

### ë¬¼ë¥˜ í…Œì´ë¸” (Supply Chain Tables)

#### 9. supply_requests - ë¬¼ë¥˜ ìš”ì²­
- **ìš©ë„**: ì í¬ì˜ ìƒí’ˆ ê³µê¸‰ ìš”ì²­
- **ê´€ê³„**:
  - stores (M:1)
  - supply_request_items (1:M)
  - shipments (1:1)

#### 10. supply_request_items - ë¬¼ë¥˜ ìš”ì²­ ìƒí’ˆ
- **ìš©ë„**: ë¬¼ë¥˜ ìš”ì²­ì— í¬í•¨ëœ ê°œë³„ ìƒí’ˆ
- **ê´€ê³„**:
  - supply_requests (M:1)
  - products (M:1)

#### 11. shipments - ë°°ì†¡
- **ìš©ë„**: ë¬¼ë¥˜ ìš”ì²­ì— ëŒ€í•œ ë°°ì†¡ ì •ë³´
- **ê´€ê³„**:
  - supply_requests (1:1)

#### 12. inventory_transactions - ì¬ê³  ê±°ë˜
- **ìš©ë„**: ëª¨ë“  ì¬ê³  ë³€ë™ ì´ë ¥ ì¶”ì 
- **ê´€ê³„**:
  - stores (M:1)
  - products (M:1)

### ë§ˆì¼€íŒ… í…Œì´ë¸” (Marketing Tables)

#### 13. points - í¬ì¸íŠ¸
- **ìš©ë„**: ì‚¬ìš©ì í¬ì¸íŠ¸ ì ë¦½/ì‚¬ìš© ë‚´ì—­
- **ê´€ê³„**:
  - profiles (M:1)

#### 14. coupons - ì¿ í°
- **ìš©ë„**: ì¿ í° ë§ˆìŠ¤í„° ì •ë³´
- **ê´€ê³„**:
  - user_coupons (1:M)

#### 15. user_coupons - ì‚¬ìš©ì ì¿ í°
- **ìš©ë„**: ì‚¬ìš©ìë³„ ì¿ í° ì†Œìœ  ë° ì‚¬ìš© ìƒíƒœ
- **ê´€ê³„**:
  - profiles (M:1)
  - coupons (M:1)

#### 16. wishlists - ìœ„ì‹œë¦¬ìŠ¤íŠ¸
- **ìš©ë„**: ì‚¬ìš©ì ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì»¬ë ‰ì…˜
- **ê´€ê³„**:
  - profiles (M:1)
  - product_wishlists (1:M)

#### 17. product_wishlists - ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ìƒí’ˆ
- **ìš©ë„**: ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— í¬í•¨ëœ ê°œë³„ ìƒí’ˆ
- **ê´€ê³„**:
  - wishlists (M:1)
  - products (M:1)

### ë¶„ì„ í…Œì´ë¸” (Analytics Tables)

#### 18. daily_sales_summary - ì¼ë³„ ë§¤ì¶œ ìš”ì•½
- **ìš©ë„**: ì í¬ë³„ ì¼ë³„ ë§¤ì¶œ ì§‘ê³„ ë°ì´í„°
- **ê´€ê³„**:
  - stores (M:1)

#### 19. product_sales_summary - ìƒí’ˆë³„ ë§¤ì¶œ ìš”ì•½
- **ìš©ë„**: ì í¬ë³„ ìƒí’ˆë³„ ë§¤ì¶œ ì§‘ê³„ ë°ì´í„°
- **ê´€ê³„**:
  - stores (M:1)
  - products (M:1)

### ì‹œìŠ¤í…œ í…Œì´ë¸” (System Tables)

#### 20. notifications - ì•Œë¦¼
- **ìš©ë„**: ì‚¬ìš©ìë³„ ì‹œìŠ¤í…œ ì•Œë¦¼
- **ê´€ê³„**:
  - profiles (M:1)

#### 21. system_settings - ì‹œìŠ¤í…œ ì„¤ì •
- **ìš©ë„**: ì „ì—­ ì‹œìŠ¤í…œ ì„¤ì • ê°’
- **ê´€ê³„**: ë…ë¦½ í…Œì´ë¸”

#### 22. point_settings - í¬ì¸íŠ¸ ì„¤ì •
- **ìš©ë„**: í¬ì¸íŠ¸ ì ë¦½/ì‚¬ìš© ì •ì±… ì„¤ì •
- **ê´€ê³„**: ë…ë¦½ í…Œì´ë¸”

## ğŸ”’ ë³´ì•ˆ ë° ê¶Œí•œ (RLS Policies)

### Row Level Security ì •ì±…
```sql
-- ê³ ê°ì€ ìì‹ ì˜ ë°ì´í„°ë§Œ ì¡°íšŒ
CREATE POLICY customer_own_data ON profiles
    FOR ALL USING (auth.uid() = id AND role = 'customer');

-- ì ì£¼ëŠ” ìì‹ ì˜ ì í¬ ë°ì´í„°ë§Œ ì¡°íšŒ
CREATE POLICY store_owner_data ON orders
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM stores 
            WHERE stores.id = orders.store_id 
            AND stores.owner_id = auth.uid()
        )
    );

-- ë³¸ì‚¬ëŠ” ëª¨ë“  ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥ (ì—­í•  ê¸°ë°˜)
CREATE POLICY headquarters_all_data ON orders
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM profiles 
            WHERE profiles.id = auth.uid() 
            AND profiles.role = 'headquarters'
        )
    );
```

## ğŸ“Š ì¸ë±ìŠ¤ ìµœì í™”

### ì£¼ìš” ì¸ë±ìŠ¤
```sql
-- ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì»¬ëŸ¼ë“¤
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_orders_store_id ON orders(store_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_store_products_store_id ON store_products(store_id);
CREATE INDEX idx_store_products_product_id ON store_products(product_id);

-- ë³µí•© ì¸ë±ìŠ¤ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_orders_store_status ON orders(store_id, status);
CREATE INDEX idx_inventory_store_product ON inventory_transactions(store_id, product_id);
```

## ğŸ”„ ë°ì´í„° ë¬´ê²°ì„±

### ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´
- **CASCADE ì‚­ì œ**: ìƒìœ„ ë°ì´í„° ì‚­ì œ ì‹œ í•˜ìœ„ ë°ì´í„° ìë™ ì‚­ì œ
- **RESTRICT ì‚­ì œ**: í•˜ìœ„ ë°ì´í„° ì¡´ì¬ ì‹œ ìƒìœ„ ë°ì´í„° ì‚­ì œ ë°©ì§€
- **NULL í—ˆìš©**: ì„ íƒì  ê´€ê³„ì—ì„œ NULL ê°’ í—ˆìš©

### CHECK ì œì•½ì¡°ê±´
- **ì—­í•  ê²€ì¦**: profiles.roleì˜ ìœ íš¨í•œ ê°’ë§Œ í—ˆìš©
- **ìƒíƒœ ê²€ì¦**: orders.statusì˜ ì •ì˜ëœ ìƒíƒœë§Œ í—ˆìš©
- **ê°€ê²© ê²€ì¦**: ìŒìˆ˜ ê°€ê²© ë°©ì§€

---
**í¸ì˜ì  ì¢…í•© ì†”ë£¨ì…˜ v2.0** | ìµœì‹  ì—…ë°ì´íŠ¸: 2025-08-17